#
# This file is auto-generated. DO NOT EDIT
# Generated by: autospec.py
#
Name     : docker-distribution
Version  : 2.6.2
Release  : 8
URL      : file:///home/clear/tar/docker-distribution-2.6.2.tar.gz
Source0  : file:///home/clear/tar/docker-distribution-2.6.2.tar.gz
Source1  : docker-distribution.service
Source2  : file:///home/clear/clearlinux/packages/docker-distribution/config.tar.xz
Summary  : No detailed summary available
Group    : Development/Tools
License  : Apache-2.0
Requires: docker-distribution-bin = %{version}-%{release}
Requires: docker-distribution-services = %{version}-%{release}
BuildRequires : buildreq-golang
BuildRequires : systemd

%description
package letsencrypt // import "rsc.io/letsencrypt"
Package letsencrypt obtains TLS certificates from LetsEncrypt.org.

%package bin
Summary: bin components for the docker-distribution package.
Group: Binaries
Requires: docker-distribution-services = %{version}-%{release}

%description bin
bin components for the docker-distribution package.


%package services
Summary: services components for the docker-distribution package.
Group: Systemd services

%description services
services components for the docker-distribution package.


%prep
%setup -q -n docker-distribution-2.6.2
cd ..
%setup -q -T -D -n docker-distribution-2.6.2 -b 2

%build
## build_prepend content
sed -i 's/elliptic.P224(), //' vendor/golang.org/x/crypto/ocsp/ocsp.go
%global provider        github
%global provider_tld    com
%global project         docker
%global repo            distribution
%global provider_prefix %{provider}.%{provider_tld}/%{project}/%{repo}
%global import_path     %{provider_prefix}
%define _sysconfdir /usr/local/etc
%define _unitdir /usr/lib/systemd/system
mkdir -p src/github.com/%{project}
ln -s ../../../ src/%{import_path}
## build_prepend end
export http_proxy=http://127.0.0.1:9/
export https_proxy=http://127.0.0.1:9/
export no_proxy=localhost,127.0.0.1,0.0.0.0
export LANG=C.UTF-8
export GOPATH="$PWD"
go build -o bin/registry %{import_path}/cmd/registry

%install
rm -rf %{buildroot}

mkdir -p %{buildroot}/usr/lib/systemd/system
install -m 0644 %{SOURCE1} %{buildroot}/usr/lib/systemd/system/docker-distribution.service
## install_append content
install -d -p %{buildroot}%{_bindir}
install -p -m 0755 $(pwd)/bin/registry %{buildroot}%{_bindir}/registry
install -d %{buildroot}%{_unitdir}
install -p -m 644 %{SOURCE1} %{buildroot}%{_unitdir}
install -d -p %{buildroot}%{_sysconfdir}/%{name}/registry
tar -xvJf %{SOURCE2}
install -p -m 644 config.yml %{buildroot}%{_sysconfdir}/%{name}/registry
install -d %{buildroot}%{_sharedstatedir}/registry
%if 0%{?with_devel}
install -d -p %{buildroot}/%{gopath}/src/%{import_path}/
echo "%%dir %%{gopath}/src/%%{import_path}/." >> devel.file-list
for file in $(find . -iname "*.go" \! -iname "*_test.go") ; do
echo "%dir %{gopath}/src/%{import_path}/$(dirname $file)" >> devel.file-list
install -d -p %{buildroot}/%{gopath}/src/%{import_path}/$(dirname $file)
cp -pav $file %{buildroot}/%{gopath}/src/%{import_path}/$file
echo "%{gopath}/src/%{import_path}/$file" >> devel.file-list
done
%endif
%if 0%{?with_unit_test} && 0%{?with_devel}
install -d -p %{buildroot}/%{gopath}/src/%{import_path}/
for file in $(find . -iname "*_test.go"); do
echo "%dir %{gopath}/src/%{import_path}/$(dirname $file)" >> devel.file-list
install -d -p %{buildroot}/%{gopath}/src/%{import_path}/$(dirname $file)
cp -pav $file %{buildroot}/%{gopath}/src/%{import_path}/$file
echo "%{gopath}/src/%{import_path}/$file" >> unit-test.file-list
done
%endif
%if 0%{?with_devel}
sort -u -o devel.file-list devel.file-list
%endif
%check
%if 0%{?with_check} && 0%{?with_unit_test} && 0%{?with_devel}
export GOPATH=%{buildroot}/%{gopath}:$(pwd)/Godeps/_workspace:%{gopath}
make test
%endif
%post
%systemd_post %{name}.service
%preun
%systemd_preun %{name}.service
%postun
%systemd_postun_with_restart %{name}.service
## install_append end

%files
%defattr(-,root,root,-)
/usr/local/etc/docker-distribution/registry/config.yml

%files bin
%defattr(-,root,root,-)
/usr/bin/registry

%files services
%defattr(-,root,root,-)
/usr/lib/systemd/system/docker-distribution.service
