#
# This file is auto-generated. DO NOT EDIT
# Generated by: autospec.py
#
Name     : openstack-keystone
Version  : 15.0.0.0rc2
Release  : 1
URL      : file:///home/clr/stx-tar/keystone-15.0.0.0rc2.tar.gz
Source0  : file:///home/clr/stx-tar/keystone-15.0.0.0rc2.tar.gz
Source1  : file:///home/clr/stx-tar/keystone.tar.gz
Summary  : OpenStack Identity
Group    : Development/Tools
License  : Apache-2.0
Requires: openstack-keystone-bin = %{version}-%{release}
Requires: openstack-keystone-config = %{version}-%{release}
Requires: openstack-keystone-data = %{version}-%{release}
Requires: openstack-keystone-python = %{version}-%{release}
Requires: openstack-keystone-python3 = %{version}-%{release}
Requires: openstack-keystone-services = %{version}-%{release}
Requires: Babel
Requires: jsonschema
Requires: keystone
Requires: oauthlib
Requires: oslo.config
Requires: oslo.policy
Requires: pbr
Requires: pysaml2
Requires: python-keystoneclient
BuildRequires : Babel
BuildRequires : buildreq-distutils3
BuildRequires : git
BuildRequires : jsonschema
BuildRequires : jsonschema-python
BuildRequires : keystonemiddleware >= 4.17.0
BuildRequires : oauthlib
BuildRequires : openstack-macros
BuildRequires : oslo.cache >= 1.26.0
BuildRequires : oslo.config
BuildRequires : oslo.db >= 4.27.0
BuildRequires : oslo.policy
BuildRequires : oslotest
BuildRequires : osprofiler >= 1.1.0
BuildRequires : passlib >= 1.6
BuildRequires : pbr
BuildRequires : pbr >= 1.8
BuildRequires : pycadf >= 2.1.0
BuildRequires : pysaml2
BuildRequires : python-dev
BuildRequires : pyzmq
BuildRequires : redis
BuildRequires : testresources
BuildRequires : testscenarios
Patch1: 0001-Rebasing-Keyring-integration.patch

%description
Team and repository tags
        ========================

%package bin
Summary: bin components for the openstack-keystone package.
Group: Binaries
Requires: openstack-keystone-data = %{version}-%{release}
Requires: openstack-keystone-config = %{version}-%{release}
Requires: openstack-keystone-services = %{version}-%{release}

%description bin
bin components for the openstack-keystone package.


%package config
Summary: config components for the openstack-keystone package.
Group: Default

%description config
config components for the openstack-keystone package.


%package data
Summary: data components for the openstack-keystone package.
Group: Data

%description data
data components for the openstack-keystone package.


%package python
Summary: python components for the openstack-keystone package.
Group: Default
Requires: openstack-keystone-python3 = %{version}-%{release}

%description python
python components for the openstack-keystone package.


%package python3
Summary: python3 components for the openstack-keystone package.
Group: Default
Requires: python3-core

%description python3
python3 components for the openstack-keystone package.


%package services
Summary: services components for the openstack-keystone package.
Group: Systemd services

%description services
services components for the openstack-keystone package.


%prep
%setup -q -n keystone-15.0.0.0rc2
cd ..
%setup -q -T -D -n keystone-15.0.0.0rc2 -b 1
%patch1 -p1

%build
## build_prepend content
PYTHONPATH=. oslo-config-generator --config-file=config-generator/keystone.conf
PYTHONPATH=. oslo-config-generator --config-file=config-generator/keystone.conf --format yaml --output-file=keystone-schema.yaml
PYTHONPATH=. oslo-config-generator --config-file=config-generator/keystone.conf --format json --output-file=keystone-schema.json
## build_prepend end
export http_proxy=http://127.0.0.1:9/
export https_proxy=http://127.0.0.1:9/
export no_proxy=localhost,127.0.0.1,0.0.0.0
export LANG=C.UTF-8
export SOURCE_DATE_EPOCH=1569809977
export GCC_IGNORE_WERROR=1
export AR=gcc-ar
export RANLIB=gcc-ranlib
export NM=gcc-nm
export CFLAGS="$CFLAGS -O3 -ffat-lto-objects -flto=4 "
export FCFLAGS="$CFLAGS -O3 -ffat-lto-objects -flto=4 "
export FFLAGS="$CFLAGS -O3 -ffat-lto-objects -flto=4 "
export CXXFLAGS="$CXXFLAGS -O3 -ffat-lto-objects -flto=4 "
export MAKEFLAGS=%{?_smp_mflags}
python3 setup.py build

%check
export http_proxy=http://127.0.0.1:9/
export https_proxy=http://127.0.0.1:9/
export no_proxy=localhost,127.0.0.1,0.0.0.0
echo "dont need check"
%install
export MAKEFLAGS=%{?_smp_mflags}
rm -rf %{buildroot}
## install_prepend content
%define _sysconfdir	/usr/local/etc
%define _unitdir /usr/lib/systemd/system/
## install_prepend end
python3 -tt setup.py build  install --root=%{buildroot}
echo ----[ mark ]----
cat %{buildroot}/usr/lib/python3*/site-packages/*/requires.txt || :
echo ----[ mark ]----
## install_append content
echo "{}" > policy.json
pwd
install -d -m 750 %{buildroot}%{_sysconfdir}/keystone/credential-keys/
install -d -m 755 %{buildroot}%{_sysconfdir}/keystone
install -p -D -m 640 etc/keystone.conf.sample %{buildroot}%{_sysconfdir}/keystone/keystone.conf
install -p -D -m 640 policy.json %{buildroot}%{_sysconfdir}/keystone/policy.json
install -p -D -m 640 keystone-schema.yaml %{buildroot}%{_datadir}/keystone/keystone-schema.yaml
install -p -D -m 640 keystone-schema.json %{buildroot}%{_datadir}/keystone/keystone-schema.json
install -p -D -m 644 keystone-dist.conf %{buildroot}%{_datadir}/keystone/keystone-dist.conf
install -p -D -m 644 etc/policy.v3cloudsample.json %{buildroot}%{_datadir}/keystone/policy.v3cloudsample.json
install -p -D -m 640 etc/logging.conf.sample %{buildroot}%{_sysconfdir}/keystone/logging.conf
install -p -D -m 640 etc/default_catalog.templates %{buildroot}%{_sysconfdir}/keystone/default_catalog.templates
install -p -D -m 640 etc/sso_callback_template.html %{buildroot}%{_sysconfdir}/keystone/sso_callback_template.html
install -d -m 755 %{buildroot}%{_prefix}/lib/sysctl.d
install -p -D -m 644 openstack-keystone.sysctl %{buildroot}%{_prefix}/lib/sysctl.d/openstack-keystone.conf
install -p -D -m 755 tools/sample_data.sh %{buildroot}%{_datadir}/keystone/sample_data.sh
install -p -D -m 755 openstack-keystone-sample-data %{buildroot}%{_bindir}/openstack-keystone-sample-data
install -p -D -m 644 httpd/wsgi-keystone.conf  %{buildroot}%{_datadir}/keystone/
install -p -D -m 755 keystone-fernet-keys-rotate-active %{buildroot}%{_bindir}/keystone-fernet-keys-rotate-active
install -p -D -m 440 password-rules.conf %{buildroot}%{_sysconfdir}/keystone/password-rules.conf
install -p -D -m 755 public.py  %{buildroot}/%{_datarootdir}/keystone/public.py
install -p -D -m 644 openstack-keystone.service %{buildroot}%{_unitdir}/openstack-keystone.service
install -p -D -m 755 keystone-all %{buildroot}%{_bindir}/keystone-all
install -d -m 755 %{buildroot}%{_sharedstatedir}/keystone
install -d -m 755 %{buildroot}%{_localstatedir}/log/keystone
rm -rf %{buildroot}/%{_prefix}%{_sysconfdir}
%if 0%{?with_doc}
sphinx-build-%{pyver} -b html doc/source doc/build/html
sphinx-build-%{pyver} -b man doc/source doc/build/man
mkdir -p %{buildroot}%{_mandir}/man1
install -p -D -m 644 doc/build/man/*.1 %{buildroot}%{_mandir}/man1/
%endif
%if 0%{?with_doc}
rm -fr doc/build/html/.doctrees doc/build/html/.buildinfo
%endif
install -d -m 755 %{buildroot}%{_datadir}
rm -f %{buildroot}%{python_sitelib}/keystone/locale/*/LC_*/keystone*po
rm -f %{buildroot}%{python_sitelib}/keystone/locale/*pot
mv %{buildroot}%{python_sitelib}/keystone/locale %{buildroot}%{_datadir}/locale
%pre
getent group keystone >/dev/null || groupadd -r --gid 163 keystone
getent passwd keystone >/dev/null || \
useradd --uid 163 -r -g keystone -d %{_sharedstatedir}/keystone -s /sbin/nologin \
-c "OpenStack Keystone Daemons" keystone
exit 0
%post
%sysctl_apply openstack-keystone.conf
touch %{_localstatedir}/log/keystone/keystone.log
chown root:keystone %{_localstatedir}/log/keystone/keystone.log
chmod 660 %{_localstatedir}/log/keystone/keystone.log
## install_append end

%files
%defattr(-,root,root,-)
/usr/local/etc/keystone/default_catalog.templates
/usr/local/etc/keystone/keystone.conf
/usr/local/etc/keystone/logging.conf
/usr/local/etc/keystone/password-rules.conf
/usr/local/etc/keystone/policy.json
/usr/local/etc/keystone/sso_callback_template.html

%files bin
%defattr(-,root,root,-)
/usr/bin/keystone-all
/usr/bin/keystone-fernet-keys-rotate-active
/usr/bin/keystone-manage
/usr/bin/keystone-status
/usr/bin/keystone-wsgi-admin
/usr/bin/keystone-wsgi-public
/usr/bin/openstack-keystone-sample-data

%files config
%defattr(-,root,root,-)
%config /usr/etc/keystone/sso_callback_template.html
/usr/lib/sysctl.d/openstack-keystone.conf

%files data
%defattr(-,root,root,-)
/usr/share/keystone/keystone-dist.conf
/usr/share/keystone/keystone-schema.json
/usr/share/keystone/keystone-schema.yaml
/usr/share/keystone/policy.v3cloudsample.json
/usr/share/keystone/public.py
/usr/share/keystone/sample_data.sh
/usr/share/keystone/wsgi-keystone.conf

%files python
%defattr(-,root,root,-)

%files python3
%defattr(-,root,root,-)
/usr/lib/python3*/*

%files services
%defattr(-,root,root,-)
/usr/lib/systemd/system/openstack-keystone.service
